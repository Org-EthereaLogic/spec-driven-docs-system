{
  "version": "1.1",
  "description": "Quality gate definitions for documentation workflow - favoring clarity over exhaustiveness",

  "gates": {
    "spec_completeness": {
      "description": "Validates that a specification is actionable before writing begins",
      "trigger": "after_spec_generation",
      "required": [
        {
          "id": "doc_type_valid",
          "description": "Document type must be one of: api, design, manual",
          "check": "doc_type in ['api', 'design', 'manual']"
        },
        {
          "id": "subject_defined",
          "description": "Subject/topic must be non-empty",
          "check": "len(subject) > 0"
        },
        {
          "id": "audience_specified",
          "description": "Target audience must be defined",
          "check": "audience is not None"
        },
        {
          "id": "sections_defined",
          "description": "At least 1 content section must be outlined (use minimal variant for simple features)",
          "check": "len(sections) >= 1"
        },
        {
          "id": "output_path_valid",
          "description": "Output path must be specified and valid",
          "check": "output_path matches valid path pattern"
        },
        {
          "id": "outcome_focus",
          "description": "Specification describes desired outcomes, not implementation details",
          "check": "no implementation-detail patterns (class names, adapter patterns, internal architecture)"
        }
      ],
      "recommended": [
        {
          "id": "source_files_listed",
          "description": "Source files to reference should be listed"
        },
        {
          "id": "examples_specified",
          "description": "Code examples to include should be specified"
        },
        {
          "id": "cross_references_defined",
          "description": "Related documents should be identified"
        }
      ],
      "pass_threshold": "all_required"
    },

    "content_quality": {
      "description": "Validates content quality after each section",
      "trigger": "after_section_completion",
      "required": [
        {
          "id": "no_placeholders",
          "description": "No placeholder text allowed",
          "check": "no matches for forbidden_patterns",
          "exceptions": [
            {
              "id": "python_protocol_ellipsis",
              "description": "Allow ellipsis (...) as standalone statement in Python Protocol/ABC method bodies",
              "rationale": "In Python typing.Protocol and abc.ABC, ellipsis is valid syntax for abstract method stubs (PEP 544). This is semantically equivalent to 'pass' and indicates the method signature without implementation.",
              "pattern": {
                "context": "python_code_block",
                "match": "^\\s*\\.\\.\\.\\s*$",
                "requires": [
                  "preceded by def statement within 5 lines",
                  "inside class inheriting from Protocol or ABC"
                ]
              },
              "allowed_forms": [
                "def method(self) -> Type:\\n    ...",
                "def method(self, arg: Type) -> Type:\\n    \"\"\"Docstring.\"\"\"\\n    ..."
              ],
              "blocked_forms": [
                "content ... more content",
                "See ... for details",
                "Args:\\n    param: ...",
                "Returns: ..."
              ]
            }
          ]
        },
        {
          "id": "no_todo_markers",
          "description": "No TODO/FIXME markers",
          "check": "no matches for TODO|FIXME|TBD"
        },
        {
          "id": "code_examples_valid",
          "description": "All code examples must be syntactically valid",
          "check": "all code blocks parse successfully"
        },
        {
          "id": "internal_links_resolve",
          "description": "All internal links must resolve",
          "check": "all internal hrefs have valid targets"
        },
        {
          "id": "scope_appropriate",
          "description": "Content depth matches feature complexity (simple features = concise docs)",
          "check": "doc_complexity proportional to feature_complexity"
        }
      ],
      "recommended": [
        {
          "id": "examples_for_complex_concepts",
          "description": "Complex concepts should have examples"
        },
        {
          "id": "consistent_terminology",
          "description": "Terminology should match glossary"
        },
        {
          "id": "proper_heading_hierarchy",
          "description": "No skipped heading levels"
        }
      ],
      "pass_threshold": "all_required"
    },

    "consistency": {
      "description": "Validates consistency before review handoff",
      "trigger": "before_review_handoff",
      "required": [
        {
          "id": "terminology_matches_glossary",
          "description": "All terms must match project glossary"
        },
        {
          "id": "naming_conventions_followed",
          "description": "Naming conventions must be followed"
        },
        {
          "id": "no_conflicting_statements",
          "description": "No contradictory information within document"
        },
        {
          "id": "format_matches_template",
          "description": "Structure must match document type template"
        }
      ],
      "pass_threshold": "all_required"
    },

    "final_approval": {
      "description": "Final gate before document is marked complete",
      "trigger": "after_review",
      "required": [
        {
          "id": "no_blocker_issues",
          "description": "No blocker-severity issues remaining"
        },
        {
          "id": "all_sections_complete",
          "description": "All required sections present and complete"
        },
        {
          "id": "cross_refs_validated",
          "description": "All cross-references validated"
        }
      ],
      "pass_threshold": "all_required"
    }
  },

  "score_calculation": {
    "clarity_weight": 0.4,
    "required_weight": 0.4,
    "recommended_weight": 0.1,
    "project_specific_weight": 0.1,
    "formula": "(clarity_score * 0.4) + (required_pass/required_total * 0.4) + (recommended_pass/recommended_total * 0.1) + (project_pass/project_total * 0.1) * 100",
    "clarity_factors": {
      "conciseness": "Penalize verbose sections that could be shorter",
      "outcome_focus": "Reward descriptions of what users achieve over how code works",
      "scope_appropriateness": "Reward documentation complexity that matches feature complexity"
    },
    "note": "Changed from completeness-focused (0.6/0.2/0.2) to clarity-focused (0.4/0.4/0.1/0.1) per simplification audit"
  },

  "grades": {
    "A": {"min": 90, "max": 100, "action": "approved"},
    "B": {"min": 80, "max": 89, "action": "approved_with_notes"},
    "C": {"min": 70, "max": 79, "action": "iteration_recommended"},
    "D": {"min": 60, "max": 69, "action": "iteration_required"},
    "F": {"min": 0, "max": 59, "action": "blocked"}
  },

  "iteration_config": {
    "max_iterations": 3,
    "auto_fix_enabled": true,
    "escalate_after_max": true,
    "rollback_on_regression": true
  }
}
